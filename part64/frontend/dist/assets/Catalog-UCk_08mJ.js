import{c as i,r as l,j as e}from"./index-DKUSIun3.js";const A=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],I=i("archive",A);const V=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],R=i("eye",V);const T=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],H=i("file-text",T);const P=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],K=i("folder-tree",P);const O=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],D=i("image",O);const G=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],U=i("play",G);const X=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],q=i("video",X),k=24,N={audio:"#a6e22e",image:"#66d9ef",video:"#fd971f",text:"#e6db74",file:"#ae81ff",dir:"#75715e"};function M(d){const o=Number.isFinite(d)?Math.max(0,d):0;if(o<1024)return`${o} B`;const m=["KB","MB","GB","TB"];let c=o/1024,u=m[0];for(let x=1;x<m.length&&c>=1024;x+=1)c/=1024,u=m[x];return`${c.toFixed(c>=10?1:2)} ${u}`}function Q({catalog:d}){const[o,m]=l.useState(!1),[c,u]=l.useState(null),[x,y]=l.useState(!1),[g,w]=l.useState(""),[_,$]=l.useState(""),j=l.useMemo(()=>async()=>{y(!0),w("");try{const t=window.location.port==="5173"?"http://127.0.0.1:8787":"",a=await fetch(`${t}/api/zips?member_limit=240`);if(!a.ok)throw new Error(`zip catalog failed: ${a.status}`);const r=await a.json();if(!r||!Array.isArray(r.zips))throw new Error("invalid zip catalog payload");u(r)}catch(t){w(t instanceof Error?t.message:"zip catalog unavailable")}finally{y(!1)}},[]);if(l.useEffect(()=>{j()},[j]),!d||!d.items)return null;const h=d.items.filter(t=>t.role!=="cover_art"),b=o?h:h.slice(0,k),E=Math.max(0,h.length-b.length),f=_.trim().toLowerCase(),p=(c?.zips??[]).filter(t=>!f||t.name.toLowerCase().includes(f)||t.rel_path.toLowerCase().includes(f)?!0:t.members.some(r=>r.path.toLowerCase().includes(f))),C=p.reduce((t,a)=>t+a.files_total,0),F=p.reduce((t,a)=>t+a.members_total,0),L=t=>{switch(t){case"audio":return e.jsx(U,{size:16});case"image":return e.jsx(D,{size:16});case"video":return e.jsx(q,{size:16});default:return e.jsx(H,{size:16})}};return e.jsxs("div",{className:"mt-3 space-y-4",children:[e.jsxs("section",{className:"rounded-xl border border-[var(--line)] bg-[rgba(39,40,34,0.84)] p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(I,{size:16}),"Zip Atlas / 圧縮アーカイブ"]}),e.jsx("p",{className:"text-xs text-muted mt-1",children:"Complete zip inventory with member map and type distribution."})]}),e.jsxs("p",{className:"text-xs text-muted font-mono",children:["zips ",e.jsx("code",{children:p.length})," | files ",e.jsx("code",{children:C})," | members ",e.jsx("code",{children:F})]})]}),e.jsxs("div",{className:"mt-3 grid gap-2 md:grid-cols-[1fr_auto] md:items-center",children:[e.jsx("input",{value:_,onChange:t=>$(t.target.value),placeholder:"filter by zip name, path, or member",className:"rounded-md border border-[var(--line)] bg-[rgba(31,32,29,0.88)] px-3 py-2 text-xs text-ink"}),e.jsx("button",{type:"button",className:"border border-[var(--line)] rounded-md bg-[rgba(39,40,34,0.9)] px-3 py-2 text-xs font-semibold text-ink hover:bg-[rgba(55,56,48,0.94)]",onClick:()=>{j()},children:"Refresh Zips"})]}),x?e.jsx("p",{className:"text-xs text-muted mt-2",children:"loading zip inventory..."}):null,g?e.jsx("p",{className:"text-xs text-[#f92672] mt-2",children:g}):null,!x&&!g&&p.length===0?e.jsx("p",{className:"text-xs text-muted mt-2",children:"No zip archives matched this filter."}):null,e.jsx("div",{className:"mt-3 space-y-3 max-h-[42rem] overflow-auto pr-1",children:p.map((t,a)=>{const r=Object.entries(t.type_counts).sort((s,n)=>n[1]-s[1]),Z=t.extension_counts.slice(0,7),S=t.top_level_entries.slice(0,6),z=Math.round(t.compression_ratio*100);return e.jsxs("details",{className:"rounded-lg border border-[var(--line)] bg-[rgba(31,32,29,0.84)] p-3",open:a===0,children:[e.jsxs("summary",{className:"list-none cursor-pointer",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.name}),e.jsx("p",{className:"text-[11px] text-muted font-mono truncate",children:t.rel_path})]}),e.jsxs("div",{className:"text-right text-[11px] text-muted font-mono",children:[e.jsxs("p",{children:[M(t.bytes)," zip"]}),e.jsxs("p",{children:[t.files_total," files / ",t.dirs_total," dirs"]}),e.jsxs("p",{children:["compression ",z,"%"]})]})]}),e.jsx("div",{className:"mt-2 h-2 rounded-full overflow-hidden bg-bg-1 flex",children:r.map(([s,n])=>{const v=n/Math.max(1,t.members_total)*100,B=N[s]??"#f8f8f2";return e.jsx("span",{style:{width:`${v}%`,backgroundColor:B},title:`${s}: ${n}`},`${t.id}-${s}`)})})]}),t.error?e.jsx("p",{className:"text-xs text-[#f92672] mt-2",children:t.error}):e.jsxs("div",{className:"mt-3 grid gap-3 lg:grid-cols-[1.5fr_1fr]",children:[e.jsxs("div",{className:"rounded-md border border-[var(--line)] bg-[rgba(39,40,34,0.78)] p-2",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted mb-2",children:"Member Map / 内容マップ"}),e.jsxs("div",{className:"max-h-[17rem] overflow-auto pr-1 space-y-1",children:[t.members.map(s=>e.jsxs("div",{className:"grid grid-cols-[auto_1fr_auto] gap-2 text-[11px] border border-[var(--line)] rounded px-2 py-1 bg-[rgba(31,32,29,0.82)]",children:[e.jsx("span",{className:"font-mono uppercase",style:{color:N[s.kind]??"#f8f8f2"},title:s.kind,children:s.kind}),s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"truncate text-[#66d9ef] hover:underline",title:s.path,children:s.path}):e.jsx("span",{className:"truncate text-muted",title:s.path,children:s.path}),e.jsx("span",{className:"font-mono text-muted text-right",children:s.is_dir?"--":M(s.bytes)})]},`${t.id}-${s.path}`)),t.members_truncated?e.jsxs("p",{className:"text-[10px] text-muted font-mono",children:["showing first ",t.members.length," of ",t.members_total," entries"]}):null]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"rounded-md border border-[var(--line)] bg-[rgba(39,40,34,0.78)] p-2",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted mb-2",children:"Type Mix / 種別分布"}),e.jsx("div",{className:"space-y-1.5 text-[11px]",children:r.map(([s,n])=>{const v=Math.round(n/Math.max(1,t.members_total)*100);return e.jsxs("div",{className:"grid grid-cols-[auto_1fr_auto] gap-2 items-center",children:[e.jsx("span",{className:"font-mono text-muted uppercase",children:s}),e.jsx("div",{className:"h-1.5 rounded bg-bg-1 overflow-hidden",children:e.jsx("div",{className:"h-full",style:{width:`${v}%`,backgroundColor:N[s]??"#f8f8f2"}})}),e.jsx("span",{className:"font-mono text-muted",children:n})]},`${t.id}-kind-${s}`)})})]}),e.jsxs("div",{className:"rounded-md border border-[var(--line)] bg-[rgba(39,40,34,0.78)] p-2",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted mb-2",children:"Extensions / 拡張子"}),e.jsx("div",{className:"space-y-1 text-[11px] font-mono text-muted",children:Z.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.ext}),e.jsx("span",{children:s.count})]},`${t.id}-ext-${s.ext}`))})]}),e.jsxs("div",{className:"rounded-md border border-[var(--line)] bg-[rgba(39,40,34,0.78)] p-2",children:[e.jsxs("p",{className:"text-[11px] uppercase tracking-wide text-muted mb-2 flex items-center gap-1",children:[e.jsx(K,{size:12}),"Top Folders / 先頭階層"]}),e.jsx("div",{className:"space-y-1 text-[11px] font-mono text-muted",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",title:s.name,children:s.name}),e.jsx("span",{children:s.count})]},`${t.id}-top-${s.name}`))})]})]})]})]},t.id)})})]}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(260px,1fr))] gap-3",children:b.map(t=>e.jsxs("article",{className:"border border-[var(--line)] rounded-xl p-3 bg-[rgba(39,40,34,0.84)]",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("strong",{className:"text-sm font-semibold",children:t.display_name.en}),e.jsx("span",{className:"text-xs text-muted",children:t.display_name.ja})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted mb-2",children:[L(t.kind),e.jsxs("span",{children:[t.display_role.en," / ",t.display_role.ja]})]}),e.jsxs("div",{className:"mt-2",children:[t.kind==="audio"&&e.jsx("audio",{controls:!0,src:t.url,className:"w-full h-8",children:e.jsx("track",{kind:"captions"})}),t.kind==="image"&&e.jsx("img",{src:t.url,alt:t.name,loading:"lazy",className:"w-full rounded-lg"}),t.kind==="video"&&e.jsx("video",{controls:!0,src:t.url,className:"w-full rounded-lg",children:e.jsx("track",{kind:"captions"})}),!["audio","image","video"].includes(t.kind)&&e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 text-sm text-[#66d9ef] hover:underline",children:[e.jsx(R,{size:14}),"View / 表示"]})]}),e.jsxs("div",{className:"mt-2 text-[10px] text-muted text-right",children:[t.part," | ",(t.bytes/1024).toFixed(1)," KB"]})]},t.rel_path))}),h.length>k?e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-[var(--line)] bg-[rgba(45,46,39,0.86)] px-3 py-2",children:[e.jsxs("p",{className:"text-xs text-muted",children:["showing ",e.jsx("code",{children:b.length})," / ",e.jsx("code",{children:h.length})," artifacts"]}),e.jsx("button",{type:"button",className:"border border-[var(--line)] rounded-md bg-[rgba(39,40,34,0.9)] px-3 py-1 text-xs font-semibold text-ink hover:bg-[rgba(55,56,48,0.96)]",onClick:()=>m(t=>!t),children:o?"Show less / 折りたたむ":`Show ${E} more / さらに表示`})]}):null]})}export{Q as CatalogPanel};
